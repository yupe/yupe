Модуль "Комментарии"
===================

Миграция на Nested Sets
-----------------------

Начиная с версии Yupe 0.6, а точнее с коммита [2db0d55](https://github.com/yupe/yupe/commit/2db0d5575a30781f29c7b56263179d02d4022d25) модуль использует
вложенные множества (nested sets) при хранении комментариев.
В случае, если вы установили версию 0.6, старше коммита [2db0d55](https://github.com/yupe/yupe/commit/2db0d5575a30781f29c7b56263179d02d4022d25) ни каких дополнительных действий производить не нужно.

В случае, если вы имеете установленную версию Yupe, вам необходимо выполнить миграцию на новую
структуру комментариев.

Поледовательность миграции на nestedsets
-----------------------

- Проверьте наличие в каталоге `vendor/yiiext/` пакета `nested-set-behavior`
- Сделайте Резервную компию (Dump) рабочей базы данных Yupe
- В файл `protected/config/modules/comment.php` в секцию `import` добавьте строку `vendor.yiiext.nested-set-behavior.NestedSetBehavior`
<pre><code class="php">
return array(
    'module'   => array(
        'class' => 'application.modules.comment.CommentModule',
    ),
    'import'    => array(
        'application.modules.comment.*',
        'application.modules.comment.models.*',
        'vendor.yiiext.nested-set-behavior.NestedSetBehavior',
    ),
    'component' => array(),
    'rules'     => array(),
);
</code></pre>

- Из панели управления сайтом очистите все кеши, а так же кеш конфигурации
- Из корня приложения выполните комманду `./yiic migratetonestedsets`. Данная команда применит необхоимую миграцию и конвертирует старые комментарии в новый формат
- Повторите очистку всех кешей из панели управления.
- Миграция завершена. Зайдите в любой раздел и проверьте результат.

**Если во время миграции произошли ошибки, выполните следущие действия**:

- Из корня приложения выполните комманду `./yiic migratetonestedsets unlock`. Данная команда откатит миграцию и разблокирует мигратор.
- Восстановите ранее сохраненную резервную копию базы данных.
- Из панели управления сайтом очистите все кеши.
- Зайдите не сайт и проверьте, что сайт вернулся в исходное положение.

**При возникновении каких либо ошибок во время миграции или проблем с миграцией, обратитесь за помощью на [наш форум](http://yupe.ru/talk/viewforum.php?id=2) или [напишите нам](http://amylabs.ru/contact)**!

